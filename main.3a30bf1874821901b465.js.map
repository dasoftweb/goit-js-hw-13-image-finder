{"version":3,"sources":["webpack:///./templates/imagesListTemplate.hbs","webpack:///./js/settings.js","webpack:///./js/api.js","webpack:///./index.js"],"names":["Handlebars","module","exports","template","container","depth0","helpers","partials","data","alias1","lambda","alias2","escapeExpression","lookupProperty","parent","propertyName","Object","prototype","hasOwnProperty","call","stack1","nullContext","program","noop","BASE_URL","setting","API_KEY","ImagesApi","selector","this","galleryRef","document","querySelector","lightboxRef","lightboxImageRef","lightboxOverlayRef","lightboxCloseRef","moreButtonRef","currentPage","totalPages","query","per_page","loadMore","bind","onGalleryClick","event","preventDefault","target","nodeName","console","log","imageRef","largeImageURL","dataset","source","largeImageALT","alt","setLightboxImage","openModal","classList","add","closeModal","remove","removeLightboxImage","url","src","search","innerHTML","fetchImages","then","results","renderImages","hits","totalHits","renderLoadMoreButton","addEventListener","scrollAfterRender","searchQuery","page","fetch","response","images","json","insertAdjacentHTML","imagesListTemplate","window","scrollTo","top","scrollY","screen","height","behavior","imagesSearch","inputRef","observerRef","_","debounce","value","observerHandler","IntersectionObserver","observe"],"mappings":"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","file":"main.3a30bf1874821901b465.js","sourcesContent":["var Handlebars = require(\"../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(container,depth0,helpers,partials,data) {\n    var alias1=container.lambda, alias2=container.escapeExpression, lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    };\n\n  return \"<li class=\\\"gallery__item\\\">\\r\\n    <div class=\\\"photo-card\\\">\\r\\n        <img src=\\\"\"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"webformatURL\") : depth0), depth0))\n    + \"\\\" data-source=\\\"\"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"largeImageURL\") : depth0), depth0))\n    + \"\\\" alt=\\\"\"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"tags\") : depth0), depth0))\n    + \"\\\" />\\r\\n\\r\\n        <div class=\\\"stats\\\">\\r\\n            <p class=\\\"stats-item\\\">\\r\\n                <i class=\\\"material-icons\\\">thumb_up</i>\\r\\n                \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"likes\") : depth0), depth0))\n    + \"\\r\\n            </p>\\r\\n            <p class=\\\"stats-item\\\">\\r\\n                <i class=\\\"material-icons\\\">visibility</i>\\r\\n                \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"views\") : depth0), depth0))\n    + \"\\r\\n            </p>\\r\\n            <p class=\\\"stats-item\\\">\\r\\n                <i class=\\\"material-icons\\\">comment</i>\\r\\n                \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"comments\") : depth0), depth0))\n    + \"\\r\\n            </p>\\r\\n            <p class=\\\"stats-item\\\">\\r\\n                <i class=\\\"material-icons\\\">cloud_download</i>\\r\\n                \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"downloads\") : depth0), depth0))\n    + \"\\r\\n            </p>\\r\\n        </div>\\r\\n    </div>\\r\\n</li>\\r\\n\";\n},\"compiler\":[8,\">= 4.3.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    };\n\n  return ((stack1 = lookupProperty(helpers,\"each\").call(depth0 != null ? depth0 : (container.nullContext || {}),depth0,{\"name\":\"each\",\"hash\":{},\"fn\":container.program(1, data, 0),\"inverse\":container.noop,\"data\":data,\"loc\":{\"start\":{\"line\":1,\"column\":0},\"end\":{\"line\":26,\"column\":9}}})) != null ? stack1 : \"\");\n},\"useData\":true});","export default {\r\n  BASE_URL: 'https://pixabay.com/api/',\r\n  API_KEY: '20663729-402ac0755ef01966534e76e9d',\r\n};\r\n\r\n","import setting from '../js/settings';\r\nimport imagesListTemplate from '../templates/imagesListTemplate.hbs';\r\n\r\nconst { BASE_URL, API_KEY } = setting;\r\n\r\nclass ImagesApi {\r\n  constructor(selector) {\r\n    this.galleryRef = document.querySelector(selector);\r\n    this.lightboxRef = document.querySelector('.js-lightbox');\r\n    this.lightboxImageRef = document.querySelector('.lightbox__image');\r\n    this.lightboxOverlayRef = document.querySelector('.lightbox__overlay');\r\n    this.lightboxCloseRef = document.querySelector(\r\n      'button[data-action=\"close-lightbox\"]',\r\n    );\r\n    this.moreButtonRef = document.querySelector('.more');\r\n    this.currentPage = 1;\r\n    this.totalPages = 0;\r\n    this.query = '';\r\n    this.per_page = 12;\r\n    this.loadMore = this.loadMore.bind(this);\r\n  }\r\n\r\n  onGalleryClick(event) {\r\n    event.preventDefault();\r\n    if (event.target.nodeName !== 'IMG') {\r\n      return;\r\n    }\r\n    console.log('Click on gallery');\r\n    const imageRef = event.target;\r\n    const largeImageURL = imageRef.dataset.source;\r\n    const largeImageALT = imageRef.alt;\r\n    console.log(largeImageURL);\r\n    this.setLightboxImage(largeImageURL, largeImageALT);\r\n    this.openModal();\r\n  }\r\n\r\n  openModal() {\r\n    this.lightboxRef.classList.add('is-open');\r\n  }\r\n\r\n  closeModal() {\r\n    this.lightboxRef.classList.remove('is-open');\r\n    this.removeLightboxImage();\r\n  }\r\n\r\n  setLightboxImage(url, alt) {\r\n    this.lightboxImageRef.src = url;\r\n    this.lightboxImageRef.alt = alt;\r\n  }\r\n\r\n  removeLightboxImage() {\r\n    this.lightboxImageRef.src = '';\r\n    this.lightboxImageRef.alt = '';\r\n  }\r\n\r\n  search(query) {\r\n    if (!query) {\r\n      return; //no query\r\n    }\r\n\r\n    if (this.query != query) {\r\n      //new quert = reset contants\r\n      this.query = query;\r\n      this.currentPage = 1;\r\n      this.totalPages = 0;\r\n      this.galleryRef.innerHTML = '';\r\n    }\r\n    console.log(`NEW QUERY`);\r\n    console.log(`Load Page: ${this.currentPage}`);\r\n\r\n    this.fetchImages(query, this.currentPage).then(results => {\r\n      this.renderImages(results.hits);\r\n      this.totalPages = results.totalHits / this.per_page;\r\n      if (results.totalHits / this.per_page > this.currentPage) {\r\n        this.renderLoadMoreButton();\r\n      }\r\n      // console.log(results.hits);\r\n    });\r\n    // render lightbox stuff\r\n    this.galleryRef.addEventListener('click', this.onGalleryClick.bind(this));\r\n    this.lightboxOverlayRef.addEventListener(\r\n      'click',\r\n      this.closeModal.bind(this),\r\n    );\r\n    this.lightboxCloseRef.addEventListener('click', this.closeModal.bind(this));\r\n  }\r\n\r\n  loadMore() {\r\n    if (!this.query) {\r\n      return;\r\n    }\r\n\r\n    if (this.totalPages <= this.currentPage) {\r\n      return;\r\n    }\r\n\r\n    this.currentPage += 1;\r\n    console.log(`Load Page: ${this.currentPage}`);\r\n\r\n    this.fetchImages(this.query, this.currentPage).then(results => {\r\n      this.renderImages(results.hits);\r\n    });\r\n    this.scrollAfterRender();\r\n  }\r\n\r\n  renderLoadMoreButton() {\r\n    this.moreButtonRef.innerHTML =\r\n      '<button id=\"load-more\" class=\"load-more\">LOAD MORE</button>';\r\n    const loadMoreBtnRef = document.querySelector('#load-more');\r\n    loadMoreBtnRef.addEventListener('click', this.loadMore);\r\n  }\r\n\r\n  async fetchImages(searchQuery, page) {\r\n    const url = `${BASE_URL}?image_type=photo&orientation=horizontal&q=${searchQuery}&page=${page}&per_page=${this.per_page}&key=${API_KEY}`;\r\n    const response = await fetch(url);\r\n    const images = response.json();\r\n    return images;\r\n  }\r\n\r\n  renderImages(images) {\r\n    this.galleryRef.insertAdjacentHTML('beforeend', imagesListTemplate(images));\r\n  }\r\n\r\n  scrollAfterRender() {\r\n    window.scrollTo({\r\n      top: window.scrollY + window.screen.height,\r\n      behavior: 'smooth',\r\n    });\r\n  }\r\n}\r\n\r\nexport default ImagesApi;\r\n","import './styles.css';\nimport debounce from 'lodash';\nimport ImagesApi from './js/api';\nimport 'material-design-icons/iconfont/material-icons.css';\n\nconst imagesSearch = new ImagesApi('.gallery');\nconst inputRef = document.querySelector('input[name=\"query\"]');\nconst observerRef = document.querySelector('.gallery-load-observer');\n\ninputRef.addEventListener(\n  'input',\n  _.debounce(() => {\n    imagesSearch.search(inputRef.value);\n  }, 1000),\n);\n\nconst observerHandler = _.debounce(() => {\n  console.log('Сработал Обс');\n  imagesSearch.loadMore();\n}, 500);\n\nconst observer = new IntersectionObserver(observerHandler);\n\nobserver.observe(observerRef);\n\n// imagesSearch.search('kiev') // hardcoded search test\n"],"sourceRoot":""}